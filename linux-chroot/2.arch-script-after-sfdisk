#!/usr/bin/bash
# Arch-script version

# Acer Bios
F2

# check Disk partition
lsblk

#   Cryptroot version
sudo cryptsetup open /dev/** 'luks'
sudo mount /dev/mapper/luks /mnt

# mount			# bootloader-size +280m
sudo mount /dev/ <path >/mnt
mkdir -p /mnt/boot/efi
sudo mount /dev/ <path >/mnt/boot/efi

lsblk

#   nmcli / nmtui
nmcli device wifi list
nmcli device wifi connect SSID_or_BSSID password password
nmcli connection show

# systemctl
#  Arch-linux
pacstrap -K /mnt base linux linux-firmware
arch-chroot /mnt/

# sudo  Manjaro
basestrap /mnt base sudo networkmanager linux6** nvim grub mkinitcpio
manjaro-chroot /mnt

# switch User
su  $USER

# fstab optional
genfstab -p /mnt >>/mnt/etc/fstab

$HOSTNAME >/etc/hostname

# useradd
useradd -mG wheel terashy
# passwd
# passwd @user

# Package Manager
pacman -Syu --needed --noconfirm grub intel-ucode zsh efibootmgr plasma sudo nvim base-devel git
# amd or intel          --> amd-ucode, intel-ucode
# < DisplayManager >    --> xfce4, plasma
# < loginManager >      --> lightdm lightdm-slick-greeter, sddm
#todo check if needed:  acpid ntp dbus avahi cups cronie    #! Test >>>> network-manager-applet dialog mtools dosfstools linux-headers bluez bluez-utils git  xdg-utils xdg-user-dirs wpa_supplicant wireless_tools

# Grub
grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=grub --recheck

grub-mkconfig -o /boot/grub/grub.cfg

mkinitcpio -p linux

# EOL
exit
umount -a
reboot

sudo systemctl enable --now NetworkManager
# sudo systemctl enable lightdm
# sudo systemctl enable --now sddm

# -----------------------------------------------
# todo

if [[ ! -f /etc/hosts ]]; then
    cat >/etc/hosts <<<EOF
    127.0.0.1 localhost
    ::1 localhost
    127.0.1.1 xps.localdomain xps
    EOF
fi

ln -s /usr/share/zoneinfo/Europe/Zurich /etc/localtime
sudo hwclock --systohc
KEYMAP=de_CH-latin1 >/etc/vconsole.conf
LANG=de_CH.UTF-8 >/etc/locale.conf
#! sudo ('LANGUAGE=de_CH.UTF-8 \nLC_ALL=de_CH.UTF-8 \nLC_MESSAGES=de_CH.UTF-8 \nLANG=de_CH.UTF-8 \n > /etc/locale.conf')
# vim /etc/locale.gen
locale-gen
timedatectl set-ntp true
journalctl --vacuum-size=33M
systemctl enable --now systemd-timesyncd
